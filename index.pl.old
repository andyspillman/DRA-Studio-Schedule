#!/usr/bin/perl
#require "cgi-lib.pl";
#require "tools.pl";


use CGI qw/:standard/;

use FindBin qw($Bin);
use lib "$Bin/database";


require DatabaseUtil;

print header(-expires=>'now');
print start_html(-title=>'DRA Studio Sign out sheet',
                 -style=>{'src'=>'/room/draStudioSched.css'},);

my $timeblock = 1;
my $day = 0;
my $timeblockowner = 1;
my $currentuser='bob';
my %labels=('bob'=>'Robert Johnson','joe'=>'Joeseph Flaw','open'=>'open');

print <<STOP1;




<table>
<tr>
<th></th>
<th>Sunday</th>
<th>Monday</th>
<th>Tuesday</th>
<th>Wednesday</th>
<th>Thursday</th>
<th>Friday</th>
<th>Saturday</th>

</tr>
STOP1
#print &table;

buildtable();


print end_html();
sub buildtable{

  until ($timeblock>4){
    
    print "<tr>";

    until ($day>7){
      makecell();
      $day++;
    }

 print "</tr>\n";
    $timeblock++;
    $day=0;
  }


}

sub makecell{
my @timeblockname = ("",
                      "8 am - 12 pm",
                      "12 pm - 4 pm",
                      "4-pm - 8 pm",
                      "8 pm - 12 am",
    );


  print "<td>";
  if ($day==0) {
      print "<p class=\"timecol\">", $timeblockname[$timeblock],"</p>";
 #fill in timeblock name
      } else {

#generate    
     print "<p>sample</p>";

   fillcell();

    };
  print "</td>";


}


sub fillcell{

  my $week=1;
  my $timeblockowner = DatabaseUtil::getowner(($week-1)*7+$day, $timeblock);
    if (1){#$currentuser == $timeblockowner||$faculty){
 dropdown($timeblockowner);
    }elsif ($timeblockowner=='open'){
      dropdown('open');
    }else{
      print $timeblockowner;     
    };
  };

sub dropdown{


#print start_form(-method=>GET);


  print CGI->popup_menu(
  -name=>$day.','.$timeblock,
  -values=>[(sort(keys %labels))],
  -default =>$_[0],
  -labels=>\%labels,
  -onChange=>"window.location.href='index.pl?day=$day&timeblock=$timeblock&newowner='+this.value",
  ); 
#print end_form;

};

#if there is owner
#if current user is owner or faculty, provide dropdown with all names
#else print name of owner
#else provide checkbox for taking ownership






